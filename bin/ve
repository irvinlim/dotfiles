#!/usr/local/bin/zsh

##
## Make virtualenv for Shopee.
## Adds private PyPi repositories and installs necessary dependencies.
##

set -e

# Make virtualenv from the default virtualenv.
virtualenv -p "$DEFAULT_VENV_PATH/bin/python" ${1:-.venv}

export PYCURL_SSL_LIBRARY=openssl
export LDFLAGS=-L/usr/local/opt/openssl/lib
export CPPFLAGS=-I/usr/local/opt/openssl/include

# Install some dependencies for Shopee.
pip install shopee-mesos-cli shopee-deploy-common requests pylint rope autopep8
pip install --install-option="--with-openssl" --install-option="--openssl-dir=/usr/local/opt/openssl" pycurl

# Copy pip.conf over to the new virtualenv..
cp "${DEFAULT_VENV_PATH}/pip.conf" ${1:-.venv}
echo "Copied pip.conf to ${1:-.venv}."

# Activate the virtualenv.
echo "Now run the following in your terminal:"
echo "venv"
